/* apps/web/src/app/api/contributions/analyze/route.ts */
import { NextResponse } from "next/server";
import { analyzeContribution } from "@features/analyze/analyzeContribution";

export async function POST(req: Request) {
  const body = await req.json().catch(() => ({}));
    const originPath = req.headers.get('x-origin-path') || null;
  const ctxFromBody = (body?.context ?? {});
  const mergedContext = { ...ctxFromBody, ui: { ...(ctxFromBody.ui||{}), route: originPath } };
const { text, maxClaims, model, forceFallback } = body ?? {};
  const context = mergedContext;
  const result = await analyzeContribution(String(text || ""), {
    maxClaims,
    model,
    forceFallback: !!forceFallback,
    context: context ?? {}
  });
  return NextResponse.json(result);
}
